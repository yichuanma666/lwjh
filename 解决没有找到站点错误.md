# è§£å†³"æ²¡æœ‰æ‰¾åˆ°ç«™ç‚¹"é”™è¯¯

## ğŸ” é”™è¯¯è¯´æ˜

å½“è®¿é—® `http://120.55.70.199` æ—¶å‡ºç°"æ²¡æœ‰æ‰¾åˆ°ç«™ç‚¹"é”™è¯¯ï¼Œé€šå¸¸æ˜¯å› ä¸ºï¼š

1. **åŸŸåæˆ– IP æ²¡æœ‰ç»‘å®šåˆ°å¯¹åº”ç«™ç‚¹**
2. **Nginx é…ç½®æ–‡ä»¶æœªç”Ÿæ•ˆ**
3. **Nginx é…ç½®é”™è¯¯**

## âœ… è§£å†³æ–¹æ¡ˆ

### æ­¥éª¤ 1ï¼šæ£€æŸ¥ Nginx é…ç½®

```bash
# æŸ¥çœ‹å½“å‰ Nginx é…ç½®
sudo cat /etc/nginx/sites-available/qk-paper-search | grep server_name

# æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la /etc/nginx/sites-available/qk-paper-search

# æ£€æŸ¥è½¯é“¾æ¥æ˜¯å¦å­˜åœ¨
ls -la /etc/nginx/sites-enabled/qk-paper-search
```

### æ­¥éª¤ 2ï¼šç¡®ä¿é…ç½®æ­£ç¡®

ç¡®ä¿ `server_name` è®¾ç½®ä¸º `_` æˆ–ä½ çš„ IP åœ°å€ï¼š

```bash
# ç¼–è¾‘é…ç½®æ–‡ä»¶
sudo vi /etc/nginx/sites-available/qk-paper-search
# æˆ–
sudo nano /etc/nginx/sites-available/qk-paper-search
```

æ£€æŸ¥å¹¶ä¿®æ”¹ `server_name` è¡Œï¼š

```nginx
server {
    listen 80;
    server_name _;  # ä½¿ç”¨ä¸‹åˆ’çº¿åŒ¹é…æ‰€æœ‰ï¼ŒåŒ…æ‹¬ IP è®¿é—®
    # æˆ–
    # server_name 120.55.70.199;  # ç›´æ¥ä½¿ç”¨ IP
    ...
}
```

### æ­¥éª¤ 3ï¼šç¡®ä¿ç«™ç‚¹å·²å¯ç”¨

```bash
# æ£€æŸ¥è½¯é“¾æ¥æ˜¯å¦å­˜åœ¨
ls -la /etc/nginx/sites-enabled/qk-paper-search

# å¦‚æœä¸å­˜åœ¨ï¼Œåˆ›å»ºè½¯é“¾æ¥
sudo ln -s /etc/nginx/sites-available/qk-paper-search /etc/nginx/sites-enabled/

# æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–é»˜è®¤ç«™ç‚¹å¹²æ‰°
ls -la /etc/nginx/sites-enabled/

# å¦‚æœå­˜åœ¨ default ç«™ç‚¹ï¼Œå¯ä»¥ç¦ç”¨æˆ–é‡å‘½å
sudo mv /etc/nginx/sites-enabled/default /etc/nginx/sites-enabled/default.bak
```

### æ­¥éª¤ 4ï¼šæµ‹è¯•å¹¶é‡æ–°åŠ è½½é…ç½®

```bash
# æµ‹è¯• Nginx é…ç½®è¯­æ³•
sudo nginx -t

# å¦‚æœæµ‹è¯•é€šè¿‡ï¼Œé‡æ–°åŠ è½½ Nginx
sudo systemctl reload nginx

# æˆ–é‡å¯ Nginx
sudo systemctl restart nginx

# æ£€æŸ¥ Nginx çŠ¶æ€
sudo systemctl status nginx
```

### æ­¥éª¤ 5ï¼šæ£€æŸ¥åº”ç”¨æœåŠ¡

```bash
# æ£€æŸ¥åº”ç”¨æœåŠ¡æ˜¯å¦è¿è¡Œ
sudo systemctl status qk-paper-search

# å¦‚æœæ²¡æœ‰è¿è¡Œï¼Œå¯åŠ¨å®ƒ
sudo systemctl start qk-paper-search

# ç¡®ä¿å¼€æœºè‡ªå¯
sudo systemctl enable qk-paper-search

# æ£€æŸ¥åº”ç”¨ç«¯å£æ˜¯å¦ç›‘å¬
sudo netstat -tlnp | grep 8000
```

## ğŸ”§ å®Œæ•´ä¿®å¤æµç¨‹

æŒ‰é¡ºåºæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
# 1. ç¡®ä¿é…ç½®æ–‡ä»¶å­˜åœ¨å¹¶æ­£ç¡®
sudo cat /etc/nginx/sites-available/qk-paper-search

# 2. ä¿®æ”¹ server_name ä¸ºåŒ¹é…æ‰€æœ‰
sudo sed -i 's/server_name.*;/server_name _;/' /etc/nginx/sites-available/qk-paper-search

# 3. åˆ›å»ºè½¯é“¾æ¥ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
sudo ln -s /etc/nginx/sites-available/qk-paper-search /etc/nginx/sites-enabled/ 2>/dev/null

# 4. ç¦ç”¨é»˜è®¤ç«™ç‚¹ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
sudo mv /etc/nginx/sites-enabled/default /etc/nginx/sites-enabled/default.bak 2>/dev/null

# 5. æµ‹è¯•é…ç½®
sudo nginx -t

# 6. é‡æ–°åŠ è½½ Nginx
sudo systemctl reload nginx

# 7. ç¡®ä¿åº”ç”¨æœåŠ¡è¿è¡Œ
sudo systemctl restart qk-paper-search

# 8. æ£€æŸ¥çŠ¶æ€
sudo systemctl status nginx
sudo systemctl status qk-paper-search
```

## ğŸš¨ è¯¦ç»†æ’æŸ¥æ­¥éª¤

### 1. æ£€æŸ¥ Nginx ä¸»é…ç½®

```bash
# æŸ¥çœ‹ Nginx ä¸»é…ç½®æ–‡ä»¶
sudo cat /etc/nginx/nginx.conf | grep include

# åº”è¯¥çœ‹åˆ°ç±»ä¼¼ï¼š
# include /etc/nginx/sites-enabled/*;
```

### 2. æ£€æŸ¥æ˜¯å¦æœ‰å¤šä¸ªç«™ç‚¹é…ç½®å†²çª

```bash
# åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„ç«™ç‚¹
ls -la /etc/nginx/sites-enabled/

# æŸ¥çœ‹æ¯ä¸ªé…ç½®æ–‡ä»¶
sudo cat /etc/nginx/sites-enabled/*
```

å¦‚æœæœ‰å¤šä¸ªé…ç½®æ–‡ä»¶ï¼Œç¡®ä¿ä¼˜å…ˆçº§æ­£ç¡®ï¼Œæˆ–è€…åªä¿ç•™ä¸€ä¸ªã€‚

### 3. æ£€æŸ¥é»˜è®¤ç«™ç‚¹

è®¸å¤š Linux å‘è¡Œç‰ˆä¼šå®‰è£…é»˜è®¤çš„ Nginx ç«™ç‚¹ï¼Œå¯èƒ½ä¼šå¹²æ‰°ï¼š

```bash
# ç¦ç”¨é»˜è®¤ç«™ç‚¹
sudo mv /etc/nginx/sites-enabled/default /etc/nginx/sites-enabled/default.bak

# æˆ–è€…åˆ é™¤é»˜è®¤ç«™ç‚¹
sudo rm /etc/nginx/sites-enabled/default

# é‡æ–°åŠ è½½
sudo nginx -t && sudo systemctl reload nginx
```

### 4. æ£€æŸ¥ç«¯å£ç›‘å¬

```bash
# æ£€æŸ¥ 80 ç«¯å£æ˜¯å¦è¢« Nginx ç›‘å¬
sudo netstat -tlnp | grep :80

# åº”è¯¥çœ‹åˆ° nginx ç›‘å¬ 0.0.0.0:80 æˆ– *:80
```

### 5. æŸ¥çœ‹ Nginx é”™è¯¯æ—¥å¿—

```bash
# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/error.log

# æŸ¥çœ‹è®¿é—®æ—¥å¿—
sudo tail -f /var/log/nginx/access.log
```

### 6. æµ‹è¯•æœ¬åœ°è®¿é—®

```bash
# åœ¨æœåŠ¡å™¨ä¸Šæµ‹è¯•
curl http://127.0.0.1
curl http://localhost
curl http://120.55.70.199
```

## ğŸ“ å®Œæ•´çš„æ­£ç¡®é…ç½®ç¤ºä¾‹

ç¡®ä¿ä½ çš„ `/etc/nginx/sites-available/qk-paper-search` æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š

```nginx
server {
    listen 80;
    server_name _;

    client_max_body_size 100M;

    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        
        proxy_connect_timeout 300s;
        proxy_send_timeout 300s;
        proxy_read_timeout 300s;
    }

    location /static {
        alias /opt/qk/static;
        expires 30d;
        add_header Cache-Control "public, immutable";
    }

    access_log /var/log/nginx/qk-paper-search-access.log;
    error_log /var/log/nginx/qk-paper-search-error.log;
}
```

## ğŸ¯ ä¸€é”®ä¿®å¤è„šæœ¬

åˆ›å»ºä¸€ä¸ªä¸´æ—¶è„šæœ¬å¿«é€Ÿä¿®å¤ï¼š

```bash
cat > /tmp/fix-nginx.sh << 'EOF'
#!/bin/bash
# ä¿®å¤ Nginx é…ç½®

# 1. ä¿®æ”¹ server_name
sudo sed -i 's/server_name.*;/server_name _;/' /etc/nginx/sites-available/qk-paper-search

# 2. åˆ›å»ºè½¯é“¾æ¥
sudo ln -sf /etc/nginx/sites-available/qk-paper-search /etc/nginx/sites-enabled/

# 3. ç¦ç”¨é»˜è®¤ç«™ç‚¹
sudo mv /etc/nginx/sites-enabled/default /etc/nginx/sites-enabled/default.bak 2>/dev/null

# 4. æµ‹è¯•é…ç½®
if sudo nginx -t; then
    sudo systemctl reload nginx
    echo "âœ… Nginx é…ç½®å·²ä¿®å¤"
else
    echo "âŒ Nginx é…ç½®æœ‰é”™è¯¯ï¼Œè¯·æ£€æŸ¥"
    exit 1
fi

# 5. ç¡®ä¿åº”ç”¨æœåŠ¡è¿è¡Œ
sudo systemctl restart qk-paper-search
sudo systemctl enable qk-paper-search

echo "âœ… ä¿®å¤å®Œæˆï¼è¯·è®¿é—® http://120.55.70.199"
EOF

chmod +x /tmp/fix-nginx.sh
sudo /tmp/fix-nginx.sh
```

## ğŸ” éªŒè¯ä¿®å¤

ä¿®å¤åï¼ŒéªŒè¯é…ç½®ï¼š

```bash
# 1. æ£€æŸ¥é…ç½®
sudo nginx -t

# 2. æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status nginx
sudo systemctl status qk-paper-search

# 3. æµ‹è¯•è®¿é—®
curl http://127.0.0.1
curl http://120.55.70.199

# 4. æ£€æŸ¥ç«¯å£
sudo netstat -tlnp | grep -E ":(80|8000)"
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å¦‚ä½•è®¿é—®åº”ç”¨.md](å¦‚ä½•è®¿é—®åº”ç”¨.md) - è®¿é—®åº”ç”¨çš„æ–¹æ³•
- [å¦‚ä½•ä¿®æ”¹Nginxé…ç½®.md](å¦‚ä½•ä¿®æ”¹Nginxé…ç½®.md) - Nginx é…ç½®è¯´æ˜
- [é…ç½®IPè®¿é—®-120.55.70.199.md](é…ç½®IPè®¿é—®-120.55.70.199.md) - IP è®¿é—®é…ç½®

---

**å¿«é€Ÿä¿®å¤å‘½ä»¤**ï¼ˆå¤åˆ¶ç²˜è´´è¿è¡Œï¼‰ï¼š

```bash
sudo sed -i 's/server_name.*;/server_name _;/' /etc/nginx/sites-available/qk-paper-search && \
sudo ln -sf /etc/nginx/sites-available/qk-paper-search /etc/nginx/sites-enabled/ && \
sudo mv /etc/nginx/sites-enabled/default /etc/nginx/sites-enabled/default.bak 2>/dev/null && \
sudo nginx -t && sudo systemctl reload nginx && \
sudo systemctl restart qk-paper-search && \
echo "âœ… ä¿®å¤å®Œæˆï¼è¯·è®¿é—® http://120.55.70.199"
```




