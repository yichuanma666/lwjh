# 部署后如何访问应用

部署完成后，有多种方式访问你的论文搜索应用。

## 🚀 快速访问

### 方式 1：通过域名访问（如果配置了域名和 Nginx）

如果你配置了域名和 Nginx，直接在浏览器访问：

```
http://your-domain.com
```

或者如果配置了 HTTPS：

```
https://your-domain.com
```

**查看你的域名**：
```bash
# 查看 Nginx 配置中的域名
cat /etc/nginx/sites-available/qk-paper-search | grep server_name
```

### 方式 2：通过服务器 IP 访问（最常用）

如果使用 IP 地址访问，需要知道服务器的公网 IP：

```bash
# 在服务器上查看 IP 地址
curl ifconfig.me
# 或
hostname -I
```

然后在浏览器访问：

```
http://服务器IP地址
```

例如：`http://192.168.1.100` 或 `http://123.45.67.89`

**如果你已知 IP 地址**，可以直接访问：
- 例如：`http://120.55.70.199`（你的 IP）

**注意**：需要先配置 Nginx 的 `server_name` 为 `_` 或你的 IP 地址。快速配置方法：
```bash
sudo sed -i 's/server_name.*;/server_name _;/' /etc/nginx/sites-available/qk-paper-search
sudo nginx -t && sudo systemctl reload nginx
```

### 方式 3：直接访问应用端口（如果未配置 Nginx）

如果直接访问应用（未配置 Nginx），使用端口 8000：

```
http://服务器IP地址:8000
```

例如：`http://192.168.1.100:8000`

---

## 📋 访问前检查清单

在访问前，确认以下几点：

### 1. 检查服务是否运行

```bash
# 检查应用服务状态
sudo systemctl status qk-paper-search

# 应该看到 "active (running)"
```

如果服务未运行：

```bash
# 启动服务
sudo systemctl start qk-paper-search

# 设置开机自启
sudo systemctl enable qk-paper-search
```

### 2. 检查端口是否监听

```bash
# 检查 8000 端口是否监听
sudo netstat -tlnp | grep 8000
# 或
sudo ss -tlnp | grep 8000

# 应该看到类似：0.0.0.0:8000 或 127.0.0.1:8000
```

### 3. 检查 Nginx 状态（如果使用 Nginx）

```bash
# 检查 Nginx 是否运行
sudo systemctl status nginx

# 如果未运行，启动它
sudo systemctl start nginx
sudo systemctl enable nginx

# 检查 Nginx 配置
sudo nginx -t
```

### 4. 检查防火墙配置

确保防火墙允许访问：

```bash
# Ubuntu/Debian (UFW)
sudo ufw status
sudo ufw allow 80/tcp    # HTTP
sudo ufw allow 443/tcp   # HTTPS
sudo ufw allow 8000/tcp  # 直接访问应用（如果不用 Nginx）

# CentOS/RHEL (firewalld)
sudo firewall-cmd --list-all
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --permanent --add-port=8000/tcp  # 如果不用 Nginx
sudo firewall-cmd --reload
```

---

## 🔍 详细访问方式

### 场景 1：使用 Nginx + 域名（推荐）

**前提条件**：
- ✅ 已配置域名 DNS 指向服务器 IP
- ✅ 已配置 Nginx 反向代理
- ✅ 已配置防火墙允许 80/443 端口

**访问地址**：
```
http://your-domain.com
```

**如果配置了 SSL**：
```
https://your-domain.com
```

**验证配置**：
```bash
# 查看 Nginx 配置
sudo cat /etc/nginx/sites-available/qk-paper-search

# 测试 Nginx 配置
sudo nginx -t

# 查看 Nginx 日志
sudo tail -f /var/log/nginx/qk-paper-search-access.log
```

### 场景 2：使用 Nginx + IP 地址

**前提条件**：
- ✅ 已配置 Nginx 反向代理
- ✅ 已配置防火墙允许 80 端口

**访问地址**：
```
http://服务器IP地址
```

**获取服务器 IP**：
```bash
# 方法 1：查看公网 IP
curl ifconfig.me

# 方法 2：查看本地 IP
hostname -I

# 方法 3：查看网络接口
ip addr show
```

**修改 Nginx 配置**（如果使用 IP 访问）：
```bash
# 编辑 Nginx 配置
sudo vi /etc/nginx/sites-available/qk-paper-search

# 将 server_name 改为你的 IP 或使用 _ (匹配所有)
server_name _;

# 重新加载 Nginx
sudo nginx -t && sudo systemctl reload nginx
```

### 场景 3：直接访问应用（未配置 Nginx）

**前提条件**：
- ✅ 应用服务正在运行
- ✅ 已配置防火墙允许 8000 端口

**访问地址**：
```
http://服务器IP地址:8000
```

**检查应用状态**：
```bash
# 查看服务日志
sudo journalctl -u qk-paper-search -f

# 测试本地访问
curl http://127.0.0.1:8000
```

**如果无法访问**，检查应用配置：
```bash
# 查看 systemd 服务配置
sudo cat /etc/systemd/system/qk-paper-search.service | grep ExecStart

# 确保绑定到 0.0.0.0:8000（而不是 127.0.0.1:8000）
# 如果只绑定到 127.0.0.1，只能从服务器本地访问
```

---

## 🛠️ 故障排查

### 问题 1：无法访问网站

**检查步骤**：

```bash
# 1. 检查服务状态
sudo systemctl status qk-paper-search
sudo systemctl status nginx  # 如果使用 Nginx

# 2. 检查端口监听
sudo netstat -tlnp | grep 8000

# 3. 检查防火墙
sudo ufw status  # Ubuntu/Debian
# 或
sudo firewall-cmd --list-all  # CentOS/RHEL

# 4. 测试本地访问
curl http://127.0.0.1:8000  # 应用
curl http://127.0.0.1  # Nginx

# 5. 查看日志
sudo journalctl -u qk-paper-search -n 50
sudo tail -f /var/log/nginx/error.log  # 如果使用 Nginx
```

### 问题 2：502 Bad Gateway

**原因**：Nginx 无法连接到后端应用

**解决方案**：
```bash
# 1. 确保应用服务运行
sudo systemctl restart qk-paper-search

# 2. 检查应用端口
sudo netstat -tlnp | grep 8000

# 3. 检查 Nginx 配置中的 proxy_pass
sudo cat /etc/nginx/sites-available/qk-paper-search | grep proxy_pass

# 4. 测试应用是否响应
curl http://127.0.0.1:8000
```

### 问题 3：403 Forbidden

**可能原因**：权限问题或配置错误

**解决方案**：
```bash
# 检查 Nginx 配置
sudo nginx -t

# 检查文件权限
ls -la /opt/qk/static

# 检查 Nginx 用户权限
ps aux | grep nginx
```

### 问题 4：连接超时

**可能原因**：防火墙阻止或网络问题

**解决方案**：
```bash
# 1. 检查防火墙规则
sudo ufw status verbose

# 2. 临时关闭防火墙测试（仅用于调试）
sudo ufw disable
# 测试访问后记得重新启用：sudo ufw enable

# 3. 检查云服务器安全组（如果使用云服务）
# 需要在云平台控制台配置安全组规则
```

---

## 🌐 云服务器特别说明

如果你使用的是云服务器（阿里云、腾讯云、AWS 等），还需要配置：

### 1. 安全组规则

在云平台控制台配置安全组，允许以下端口：
- **80** (HTTP)
- **443** (HTTPS)
- **8000** (如果直接访问应用)

### 2. 公网 IP

确保服务器有公网 IP，或配置了弹性 IP。

### 3. DNS 配置（如果使用域名）

在域名管理平台配置 A 记录，指向服务器公网 IP。

---

## 📱 本地测试访问

在服务器上测试：

```bash
# 测试应用直接访问
curl http://127.0.0.1:8000

# 测试 Nginx 代理
curl http://127.0.0.1

# 如果使用域名，测试域名解析
curl http://your-domain.com
```

---

## ✅ 访问成功标志

访问成功后，你应该看到：

1. **论文搜索页面** - 有搜索框和选项
2. **可以输入关键词搜索**
3. **可以查看搜索结果**

如果看到这些，说明部署成功！

---

## 🔐 配置 HTTPS（可选但推荐）

如果希望使用 HTTPS 访问：

```bash
# 安装 Certbot
sudo apt install certbot python3-certbot-nginx -y  # Ubuntu/Debian
sudo yum install certbot python3-certbot-nginx -y  # CentOS/RHEL

# 获取 SSL 证书
sudo certbot --nginx -d your-domain.com

# 证书会自动配置，之后可以通过 https://your-domain.com 访问
```

---

## 📞 快速检查命令

```bash
# 一键检查所有状态
echo "=== 服务状态 ===" && \
sudo systemctl status qk-paper-search --no-pager -l && \
echo -e "\n=== Nginx 状态 ===" && \
sudo systemctl status nginx --no-pager -l && \
echo -e "\n=== 端口监听 ===" && \
sudo netstat -tlnp | grep -E ":(80|443|8000)" && \
echo -e "\n=== 防火墙状态 ===" && \
sudo ufw status 2>/dev/null || sudo firewall-cmd --list-all
```

---

## 📚 相关文档

- [DEPLOYMENT.md](DEPLOYMENT.md) - 完整部署文档
- [故障排除清单.md](故障排除清单.md) - 常见问题解决
- [QUICK_START_DEPLOY.md](QUICK_START_DEPLOY.md) - 快速部署指南

---

**最常用的访问方式**：
- 有域名：`http://your-domain.com`
- 无域名：`http://服务器IP地址`

